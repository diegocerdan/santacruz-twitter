<html><head><link rel="import" href="/bower_components/polymer/polymer-element.html"><link rel="import" href="/bower_components/polymer/lib/elements/dom-if.html"><link rel="import" href="/bower_components/polymer/lib/elements/dom-repeat.html"><link rel="import" href="/bower_components/polymer/lib/utils/debounce.html"><link rel="import" href="/bower_components/polymer/lib/utils/async.html"><link rel="import" href="/bower_components/polymerfire/firebase-document.html"><link rel="import" href="/bower_components/polymerfire/firebase-query.html"><link rel="import" href="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html"><link rel="import" href="/bower_components/iron-list/iron-list.html"><link rel="import" href="/bower_components/iron-icons/iron-icons.html"><link rel="import" href="/bower_components/iron-icons/image-icons.html"><link rel="import" href="/bower_components/paper-input/paper-input.html"><link rel="import" href="/bower_components/paper-button/paper-button.html"><link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="twitter-dashboard-header.html"><link rel="import" href="twitter-dashboard-tweet.html"><link rel="import" href="santacruz-handler.html"><script src="twitter-accounts.js"></script></head><body><dom-module id="twitter-dashboard"><template><style>:host{display:block;}#time, #account{min-width:160px;}#text-filter{position:relative;top:-9px;flex-grow:1;display:block;}#media, #retweets, #favorites{min-width:64px;text-align:center;}iron-list{flex:1 1 auto;height:600px;}</style><firebase-query id="query" path="/tweets" data="{{localTweets}}" order-by-child="timestamp" disabled="{{disabled}}" start-at="{{dateStart}}" end-at="{{dateEnd}}"></firebase-query><twitter-dashboard-header sort-by="{{sortBy}}" sort-reverse="{{sortReverse}}" filter-keyword="{{filterKeyword}}"></twitter-dashboard-header><paper-listbox><template is="dom-repeat" id="tweetlist" items="[[localTweets]]" as="tweet" filter="_filter" sort="_sort" initialcount="20"><div><twitter-dashboard-tweet timestamp="[[tweet.timestamp]]" user_id="[[tweet.user_id]]" text="[[tweet.text]]" retweet_count="[[tweet.retweet_count]]" favorite_count="[[tweet.favorite_count]]" has_media="[[tweet.has_media]]" key="[[tweet.$key]]"></twitter-dashboard-tweet></div></template></paper-listbox></template><script>class TwitterDashboard extends Polymer.Element{static get is(){return"twitter-dashboard"}static get properties(){return{sortBy:{type:String,value:"timestamp",observer:"_sortByChanged"},sortReverse:{type:Boolean,value:!1,observer:"_sortReverseChanged"},filterKeyword:{type:String,value:"",observer:"_filterKeyboardChanged"},filterCount:{type:Number,value:0},tweets:{type:Array,value:function(){return[]}},localTweets:{type:Array,value:function(){return[]}},disabled:{type:Boolean,value:!1},dateStart:{type:Number,observer:"_onDateChanged",reflectToAttribute:!0},dateEnd:{type:Number,observer:"_onDateChanged",reflectToAttribute:!0},accountsFiltered:{observer:"_accountsFilteredChanged"}}}_accountsFilteredChanged(){console.log("Accounts Filtered Changed"),this.$.tweetlist.__renderDebouncer.cancel(),this.$.tweetlist.render()}_sortReverseChanged(c){console.log("New sort direction:"),console.log(c),this.$.tweetlist.__renderDebouncer.cancel(),this.$.tweetlist.render()}_sortByChanged(c){console.log("New sort value:"),console.log(c),this.$.tweetlist.__renderDebouncer.cancel(),this.$.tweetlist.render()}_sort(c,d){return"interactions"==this.sortBy?(c=c.retweet_count+c.favorite_count,d=d.retweet_count+d.favorite_count):(c=c[this.sortBy],d=d[this.sortBy]),c<d?this.sortReverse?-1:1:c>d?this.sortReverse?1:-1:0}_filter(c){return!this.accountsFiltered.includes(c.user_id)&&(2>this.filterKeyword.length?(this.filterCount++,!0):-1!=c.text.search(new RegExp(this.filterKeyword,"i"))&&(this.filterCount++,!0))}_filterKeyboardChanged(c,d){this.$.tweetlist.__renderDebouncer.cancel(),this.filterCount=0;var e=150;d&&c.length<d.length&&(e=300),this._debouncerFilter=Polymer.Debouncer.debounce(this._debouncerFilter,Polymer.Async.timeOut.after(e),()=>{this.$.tweetlist.render()})}_updateFirebaseQuery(){console.log("START: "+this.dateStart),console.log("END: "+this.dateEnd);void 0==this.dateStart||void 0==this.dateEnd||(this.disabled=!1,console.log(this.disabled))}_onDateChanged(){this.filterCount=0,this._debouncer=Polymer.Debouncer.debounce(this._debouncer,Polymer.Async.timeOut.after(100),()=>{this._updateFirebaseQuery()})}_expandIconState(c){return c?"expand-less":"expand-more"}_timestamp2moment(c){if(c==void 0)return!1;moment.locale("es");var d=moment(1e3*c),e=d.fromNow();return e}_account_nickname(c){return void 0!=c&&twitter_accounts[c].nickname}_account_username(c){return void 0!=c&&twitter_accounts[c].username}_to_string(c){return c.toString()}_onTimestampChanged(){this.timestamp_start!=void 0&&this.timestamp_end!=void 0&&(this.disabled=!1)}}window.customElements.define(TwitterDashboard.is,TwitterDashboard);</script></dom-module></body></html>