<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html">
<!--<link rel="import" href="shared-styles.html">-->

<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/app-datepicker/app-datepicker.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<script src="../bower_components/moment/moment.js"></script>
<script src="../bower_components/moment/locale/es.js"></script>


</head><body><dom-module id="datepicker-filter">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-dialog {
        display: flex;
        flex-direction: column;
      }

      #datepickers {
        display: flex;
        flex-direction: row;
      }

      app-datepicker + app-datepicker {
        margin-left: 80px;
      }
    </style>


    <paper-dialog id="dialog">
      <h2>Rango de Fechas</h2>

      <div id="datepickers">
        <app-datepicker id="datepicker_start" locale="es" input-date="[[dateStart]]" min-date="2006/03/21" max-date="[[dateToday]]" disable-days="[]" first-day-of-week="1" format="yyyy/mm/dd">
        </app-datepicker>

        <app-datepicker id="datepicker_end" locale="es" input-date="[[dateEnd]]" min-date="2006/03/21" max-date="[[dateToday]]" disable-days="[]" first-day-of-week="1" format="yyyy/mm/dd">
        </app-datepicker>
      </div>

      <div class="buttons">
        <paper-button dialog-dismiss="">Descartar</paper-button>
        <paper-button dialog-confirm="" autofocus="" on-tap="_handleOnTap">Aceptar</paper-button>
      </div>
    </paper-dialog>

  </template>

  
  <script>
  
    class DatepickerFilter extends Polymer.Element {
      static get is() { return 'datepicker-filter'; }
      static get properties() {
        return {
          dateToday: {
            type: String,
            value: function() {
              return moment().locale('es').startOf('day').format("YYYY/MM/DD");
            }
          },
          
          momentStart: {
            type: Object,
            value: function() {
              return moment().locale('es').subtract(5, 'days').startOf('day');
            }
          },
          
          momentEnd: {
            type: Object,
            value: function() {
              return moment().locale('es').add(1, 'days').startOf('day');
            }
          },   
          
          dateStart: {
            type: String,
            computed: '_computeDateStart(momentStart)'
          },
          
          dateEnd: {
            type: String,
            computed: '_computeDateEnd(momentEnd)'
          },
          
          unixEpochStart: {
            type: String,
            computed: '_computedUnixEpochStart(dateStart)',
            notify: true,
            reflectToAttribute: true
          },
          
          unixEpochEnd: {
            type: String,
            computed: '_computedUnixEpochEnd(dateEnd)',
            notify: true,
            reflectToAttribute: true
          }
        };
      }

      _computeDateStart(momentStart) {
        return momentStart.format("YYYY/MM/DD");
      }
      
      _computeDateEnd(momentEnd) {
        return momentEnd.format("YYYY/MM/DD");
      }
      
      _computedUnixEpochStart(dateStart) {
        return moment(this._toRFC2822(dateStart)).unix().toString();
      }
      
      _computedUnixEpochEnd(dateEnd) {
        return moment(this._toRFC2822(dateEnd)).unix().toString();
      }
      
      _handleOnTap() {
        this.$.datepicker_start.enforceDateChange();
        this.$.datepicker_end.enforceDateChange();
        
        this.momentStart = moment(this._toRFC2822(this.$.datepicker_start.date));
        this.momentEnd = moment(this._toRFC2822(this.$.datepicker_end.date));
      }
      
      _toRFC2822(date) {
        return date.replace("/", "-").replace("/", "-");
      }
      
      toggle() {
        this.$.dialog.toggle();
      }
    }

    window.customElements.define(DatepickerFilter.is, DatepickerFilter);
  </script>
  
</dom-module>
</body></html>